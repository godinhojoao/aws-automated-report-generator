<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= reportTitle %></title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #7f8c8d;
            margin: 10px 0 0 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            text-align: center;
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin: 0;
        }
        .charts-section {
            margin-bottom: 40px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .chart-container h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .tables-section {
            margin-bottom: 40px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        tr:hover {
            background-color: #f8f9fa;
        }
        .category-section {
            margin-bottom: 40px;
        }
        .category-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        .category-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .category-stat {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .category-stat .label {
            font-size: 0.8em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .category-stat .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
            margin: 5px 0 0 0;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            color: #7f8c8d;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .header h1 {
                font-size: 2em;
            }
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            .chart-wrapper {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><%= reportTitle %></h1>
            <p>Generated on <%= new Date().toLocaleDateString() %> • <%= stats.totalEntries %> entries • <%= stats.uniqueCategories.length %> categories</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Value</h3>
                <p class="value"><%= formatNumber(stats.totalValue) %></p>
            </div>
            <div class="stat-card">
                <h3>Average Value</h3>
                <p class="value"><%= formatNumber(stats.averageValue) %></p>
            </div>
            <div class="stat-card">
                <h3>Highest Value</h3>
                <p class="value"><%= formatNumber(stats.maxValue) %></p>
            </div>
            <div class="stat-card">
                <h3>Lowest Value</h3>
                <p class="value"><%= formatNumber(stats.minValue) %></p>
            </div>
            <div class="stat-card">
                <h3>Total Entries</h3>
                <p class="value"><%= stats.totalEntries %></p>
            </div>
            <div class="stat-card">
                <h3>Categories</h3>
                <p class="value"><%= stats.uniqueCategories.length %></p>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-container">
                <h2>Category Distribution</h2>
                <div class="chart-wrapper">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2>Monthly Trends</h2>
                <div class="chart-wrapper">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2>Top 10 Entries by Value</h2>
                <div class="chart-wrapper">
                    <canvas id="topEntriesChart"></canvas>
                </div>
            </div>
        </div>

        <div class="tables-section">
            <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">Top 10 Entries</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Value</th>
                        <th>Category</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <% stats.topEntries.forEach((entry, index) => { %>
                        <tr>
                            <td><%= index + 1 %></td>
                            <td><%= entry.id %></td>
                            <td><%= entry.name %></td>
                            <td><%= formatNumber(entry.value) %></td>
                            <td><%= entry.category %></td>
                            <td><%= entry.date %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>

            <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">Category Summary</h2>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Entry Count</th>
                        <th>Total Value</th>
                        <th>Average Value</th>
                        <th>Min Value</th>
                        <th>Max Value</th>
                    </tr>
                </thead>
                <tbody>
                    <% Object.keys(stats.categoryStats).forEach(category => { 
                        const catStats = stats.categoryStats[category]; %>
                        <tr>
                            <td><%= category %></td>
                            <td><%= catStats.count %></td>
                            <td><%= formatNumber(catStats.totalValue) %></td>
                            <td><%= formatNumber(catStats.averageValue) %></td>
                            <td><%= formatNumber(catStats.minValue) %></td>
                            <td><%= formatNumber(catStats.maxValue) %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <div class="category-section">
            <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">Category Details</h2>
            <% Object.keys(stats.categoryStats).forEach(category => { 
                const catStats = stats.categoryStats[category];
                const topEntries = catStats.entries
                    .sort((a, b) => b.value - a.value)
                    .slice(0, 5); %>
                <div class="category-card">
                    <div class="category-header">
                        <h3 style="margin: 0; color: #2c3e50;"><%= category %></h3>
                        <span style="color: #7f8c8d;"><%= catStats.count %> entries</span>
                    </div>
                    <div class="category-stats">
                        <div class="category-stat">
                            <div class="label">Total Value</div>
                            <div class="value"><%= formatNumber(catStats.totalValue) %></div>
                        </div>
                        <div class="category-stat">
                            <div class="label">Average</div>
                            <div class="value"><%= formatNumber(catStats.averageValue) %></div>
                        </div>
                        <div class="category-stat">
                            <div class="label">Highest</div>
                            <div class="value"><%= formatNumber(catStats.maxValue) %></div>
                        </div>
                        <div class="category-stat">
                            <div class="label">Lowest</div>
                            <div class="value"><%= formatNumber(catStats.minValue) %></div>
                        </div>
                    </div>
                    <table style="width: 100%; margin-top: 15px;">
                        <thead>
                            <tr>
                                <th style="width: 60%;">Top Entries</th>
                                <th style="width: 40%; text-align: right;">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% topEntries.forEach(entry => { %>
                                <tr>
                                    <td><%= entry.name %></td>
                                    <td style="text-align: right;"><%= formatNumber(entry.value) %></td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% }); %>
        </div>

        <div class="footer">
            <p>Report generated on <%= new Date().toLocaleString() %> • Data range: <%= stats.dateRange.start %> to <%= stats.dateRange.end %></p>
        </div>
    </div>

    <script>
        const categoryLabels = <%- JSON.stringify(chartData.categoryLabels) %>;
        const categoryValues = <%- JSON.stringify(chartData.categoryValues) %>;
        const monthlyLabels = <%- JSON.stringify(chartData.monthlyLabels) %>;
        const monthlyValues = <%- JSON.stringify(chartData.monthlyValues) %>;
        const monthlyCounts = <%- JSON.stringify(chartData.monthlyCounts) %>;
        const topEntryLabels = <%- JSON.stringify(chartData.topEntryLabels) %>;
        const topEntryValues = <%- JSON.stringify(chartData.topEntryValues) %>;

        function formatNumber(num) {
            if (typeof num !== 'number') return num;
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: categoryLabels,
                        datasets: [{
                            data: categoryValues,
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return context.label + ': ' + formatNumber(value) + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const monthlyCtx = document.getElementById('monthlyChart');
            if (monthlyCtx) {
                new Chart(monthlyCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: monthlyLabels,
                        datasets: [{
                            label: 'Monthly Total Value',
                            data: monthlyValues,
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#36A2EB',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const index = context.dataIndex;
                                        return [
                                            'Total Value: ' + formatNumber(context.raw),
                                            'Entry Count: ' + monthlyCounts[index]
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatNumber(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const topEntriesCtx = document.getElementById('topEntriesChart');
            if (topEntriesCtx) {
                new Chart(topEntriesCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: topEntryLabels,
                        datasets: [{
                            label: 'Value',
                            data: topEntryValues,
                            backgroundColor: 'rgba(54, 162, 235, 0.8)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            borderRadius: 4,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return 'Value: ' + formatNumber(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatNumber(value);
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

